<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Todo List</title>
  </head>
  <body>
    <main>
      <section>
        <div class="todoList">
          <header><h1>TodoList</h1></header>
          <input type="text" class="todoList__inputBar" />
          <ul class="todoList__content" id="todoList__content"></ul>
        </div>
      </section>
      <section>
        <div class="finishList">
          <header><h1>FinishList</h1></header>
          <ul class="finishList__content" id="finishList__content"></ul>
        </div>
      </section>
      <script>
        const View = (function() {
          const domString = {
            todoList: "#todoList__content",
            todoListInput: ".todoList__inputBar",
            finishList: "#finishList__content"
          };

          return { domString };
        })();

        const Model = (function() {
          class ListItem {
            constructor(listText) {
              this.listText = listText;
              this.id = new Date().getTime();
              console.log("DATE",this.id);
            }
          }

          class TodoItem extends ListItem {
            generateTodoItemTmp() {
              
              return `<li>${this.listText}<button type="button" id="${this.id}" class="btnDelete">Remove</button><button type="button" id="${this.id}" class="btnCheck">Check</button></li>`;
            }
          }

          class FinishItem extends ListItem {
            generateFinishItemTmp() {
              return `<li>${this.listText}</li>`;
            }
          }

          return {
            TodoItem, FinishItem
          };
        })();

        const Controller = (function(view, model) {
          const render = (tmp, element) => {
            element.innerHTML = tmp;
          };

          class State {
            constructor() {
              this._todoList = [];
              this._finishList = [];
            }

            get todoList() {
              console.log("get todoList");
              return this._todoList;
            }

            set todoList(newValue) {
              console.log("set todoList");
              console.log(newValue);
              this._todoList = newValue;
              let tmp = newValue
                .map(todoItem => todoItem.generateTodoItemTmp())
                .join("");
              render(tmp, elements.todoListElement);
            }

            get finishList() {
              console.log("get finishList");
              return this._finishList;
            }

            set finishList(newValue) {
              console.log("set todoList");
              this._finishList = newValue;
              let tmp = newValue
                .map(finishItem => finishItem.generateFinishItemTmp())
                .join("");
              render(tmp, elements.finishListElement);
            }
          }

          let state = new State();

          const elements = {
            todoListElement: document.querySelector(view.domString.todoList),
            todoListInputElement: document.querySelector(
              view.domString.todoListInput
            ),
            finishListElement: document.querySelector(view.domString.finishList)
          };

          const setEvent = () => {
            elements.todoListInputElement.addEventListener("keyup", e => {
              if (event.keyCode == 13) {
                //implement
                //Update the todoList State
                let newTodo = new model.TodoItem(event.target.value);
                state.todoList = [...state.todoList, newTodo];
              }
            });
          };

          const checkEvent = () => {
            elements.todoListElement.addEventListener("click", () => {
              if (event.target.className === "btnCheck") {
                //console.log(event.target.id);
                state.todoList = state.todoList.filter(item => {
                  console.log(typeof item.id);
                  console.log(typeof event.target.id);
                  if (item.id == event.target.id) {
                    console.log("ITEM",item.listText);
                    let newFinish = new model.FinishItem(item.listText);
                    state.finishList = [...state.finishList, newFinish];
                    console.log("finish",state.finishList);
                    return false;  
                  } else {
                    return true;
                  }
                });
              }
            });
          };

          const deleteEvent = () => {
            elements.todoListElement.addEventListener("click", () => {
              if (event.target.className === "btnDelete") {
                state.todoList = state.todoList.filter(item => {
                  if (item.id == event.target.id) {
                    return false;
                  } else {
                    return true;
                  }
                });
              }
            });
          };

          return {
            initApp: function() {
              console.log("init App");
              setEvent();
              checkEvent();
              deleteEvent();
            }
          };
        })(View, Model);
        console.log(View);
        console.log(Model);
        console.log(Controller);
        Controller.initApp();
      </script>
    </main>
  </body>
</html>
